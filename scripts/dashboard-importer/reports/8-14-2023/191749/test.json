{
    "displayName": "K8s / Storage / Volumes / Namespace",
    "dashboardFilters": [
        {
            "labelKey": "namespace",
            "templateVariable": "namespace",
            "stringValue": "",
            "filterType": "RESOURCE_LABEL"
        },
        {
            "labelKey": "persistentvolumeclaim",
            "templateVariable": "persistentvolumeclaim",
            "stringValue": "",
            "filterType": "METRIC_LABEL"
        }
    ],
    "mosaicLayout": {
        "columns": 24,
        "tiles": [
            {
                "widget": {
                    "scorecard": {
                        "sparkChartView": {
                            "sparkChartType": "SPARK_LINE"
                        },
                        "thresholds": [],
                        "timeSeriesQuery": {
                            "prometheusQuery": "(\n count (\n   (kubelet_volume_stats_available_bytes {namespace=\"${namespace.value}\"})\n   and\n   (predict_linear(kubelet_volume_stats_available_bytes {namespace=\"${namespace.value}\"}[1d], 7 * 24 * 60 * 60) < 0)\n )\n)\nor\nvector(0)"
                        }
                    },
                    "title": "Volumes Full in Week Based on Daily Use Rate"
                },
                "xPos": 0,
                "yPos": 1,
                "height": 3,
                "width": 14
            },
            {
                "widget": {
                    "scorecard": {
                        "sparkChartView": {
                            "sparkChartType": "SPARK_LINE"
                        },
                        "thresholds": [],
                        "timeSeriesQuery": {
                            "prometheusQuery": "count (max by (persistentvolumeclaim,namespace) (kubelet_volume_stats_used_bytes {namespace=\"${namespace.value}\"}) and (max by (persistentvolumeclaim,namespace) (kubelet_volume_stats_used_bytes {namespace=\"${namespace.value}\"})) / (max by (persistentvolumeclaim,namespace) (kubelet_volume_stats_capacity_bytes {namespace=\"${namespace.value}\"})) >= ($pvc_percent_used_warning_threshold / 100)) or vector (0)"
                        }
                    },
                    "title": "Running PVCs Above % Used Warning Threshold"
                },
                "xPos": 0,
                "yPos": 4,
                "height": 3,
                "width": 7
            },
            {
                "widget": {
                    "scorecard": {
                        "sparkChartView": {
                            "sparkChartType": "SPARK_LINE"
                        },
                        "thresholds": [],
                        "timeSeriesQuery": {
                            "prometheusQuery": "(max (sum by (exported_namespace) (pv_collector_unbound_pvc_count {exported_namespace = \"${namespace.value}\"}))) or (vector(0))"
                        }
                    },
                    "title": "Unbound PVCs"
                },
                "xPos": 7,
                "yPos": 4,
                "height": 3,
                "width": 7
            },
            {
                "widget": {
                    "timeSeriesTable": {
                        "columnSettings": [
                            {
                                "column": "value",
                                "visible": false
                            }
                        ],
                        "dataSets": [
                            {
                                "timeSeriesQuery": {
                                    "prometheusQuery": "(\n  (\n    (kubelet_volume_stats_available_bytes {namespace=~\"(openshift-.*|kube-.*|default|logging)\"} ) \n    and\n    (predict_linear(kubelet_volume_stats_available_bytes {namespace=~\"(openshift-.*|kube-.*|default|logging)\"}[1w], 7 * 24 * 60 * 60) < 0)\n  )\n)"
                                },
                                "outputFullDuration": true
                            }
                        ],
                        "metricVisualization": "NUMBER"
                    }
                },
                "xPos": 0,
                "yPos": 8,
                "height": 14,
                "width": 8
            },
            {
                "widget": {
                    "title": "Volumes Full in Week Based on Daily Use Rate - Alert History",
                    "xyChart": {
                        "dataSets": [
                            {
                                "plotType": "STACKED_AREA",
                                "timeSeriesQuery": {
                                    "prometheusQuery": "(\n  (\n    ((kubelet_volume_stats_used_bytes {namespace=\"${namespace.value}\"} ) * 0) + 1\n    and\n    (predict_linear(kubelet_volume_stats_available_bytes {namespace=\"${namespace.value}\"}[1d], 7 * 24 * 60 * 60) < 0)\n  )\n)"
                                },
                                "legendTemplate": "{{persistentvolumeclaim}}"
                            }
                        ]
                    }
                },
                "xPos": 8,
                "yPos": 8,
                "height": 7,
                "width": 16
            },
            {
                "widget": {
                    "title": "Volumes Full in Week Based on Daily Use Rate -  Predicted Available Space History",
                    "xyChart": {
                        "dataSets": [
                            {
                                "plotType": "LINE",
                                "timeSeriesQuery": {
                                    "prometheusQuery": "(\n  (predict_linear(kubelet_volume_stats_available_bytes {namespace=\"${namespace.value}\"}[1d], 7 * 24 * 60 * 60) < 0)\n)"
                                },
                                "legendTemplate": "{{persistentvolumeclaim}}"
                            }
                        ]
                    }
                },
                "xPos": 8,
                "yPos": 15,
                "height": 7,
                "width": 16
            },
            {
                "widget": {
                    "timeSeriesTable": {
                        "columnSettings": [
                            {
                                "column": "value",
                                "visible": false
                            }
                        ],
                        "dataSets": [
                            {
                                "timeSeriesQuery": {
                                    "prometheusQuery": "(\n  (kube_persistentvolumeclaim_info {namespace=\"${namespace.value}\"})\n  and\n  (\n    (\n      (max by (persistentvolumeclaim,namespace) (kubelet_volume_stats_used_bytes {namespace=\"${namespace.value}\"}))\n      /\n      (max by (persistentvolumeclaim,namespace) (kubelet_volume_stats_capacity_bytes {namespace=\"${namespace.value}\"}))\n    ) >= ($pvc_percent_used_warning_threshold / 100)\n  )\n)"
                                },
                                "outputFullDuration": true
                            },
                            {
                                "timeSeriesQuery": {
                                    "prometheusQuery": "(max by (persistentvolumeclaim,namespace) (kubelet_volume_stats_used_bytes {namespace=\"${namespace.value}\"})) and ((max by (persistentvolumeclaim,namespace) (kubelet_volume_stats_used_bytes {namespace=\"${namespace.value}\"})) / (max by (persistentvolumeclaim,namespace) (kubelet_volume_stats_capacity_bytes {namespace=\"${namespace.value}\"})) >= ($pvc_percent_used_warning_threshold / 100))"
                                },
                                "outputFullDuration": true
                            },
                            {
                                "timeSeriesQuery": {
                                    "prometheusQuery": "(max by (persistentvolumeclaim,namespace) (kubelet_volume_stats_capacity_bytes {namespace=\"${namespace.value}\"})) and ((max by (persistentvolumeclaim,namespace) (kubelet_volume_stats_used_bytes {namespace=\"${namespace.value}\"})) / (max by (persistentvolumeclaim,namespace) (kubelet_volume_stats_capacity_bytes {namespace=\"${namespace.value}\"})) >= ($pvc_percent_used_warning_threshold / 100))"
                                },
                                "outputFullDuration": true
                            },
                            {
                                "timeSeriesQuery": {
                                    "prometheusQuery": "(max by (persistentvolumeclaim,namespace) (kubelet_volume_stats_available_bytes {namespace=\"${namespace.value}\"})) and ((max by (persistentvolumeclaim,namespace) (kubelet_volume_stats_used_bytes {namespace=\"${namespace.value}\"})) / (max by (persistentvolumeclaim,namespace) (kubelet_volume_stats_capacity_bytes {namespace=\"${namespace.value}\"})) >= ($pvc_percent_used_warning_threshold / 100))"
                                },
                                "outputFullDuration": true
                            },
                            {
                                "timeSeriesQuery": {
                                    "prometheusQuery": "(max by (persistentvolumeclaim,namespace) (kubelet_volume_stats_used_bytes {namespace=\"${namespace.value}\"})) / (max by (persistentvolumeclaim,namespace) (kubelet_volume_stats_capacity_bytes {namespace=\"${namespace.value}\"})) >= ($pvc_percent_used_warning_threshold / 100)"
                                },
                                "outputFullDuration": true
                            }
                        ],
                        "metricVisualization": "NUMBER"
                    }
                },
                "xPos": 0,
                "yPos": 22,
                "height": 6,
                "width": 8
            },
            {
                "widget": {
                    "title": "Running PVCs Above % Used Warning Threshold",
                    "xyChart": {
                        "dataSets": [
                            {
                                "plotType": "STACKED_AREA",
                                "timeSeriesQuery": {
                                    "prometheusQuery": "(\n  ((max by (persistentvolumeclaim,namespace) (kubelet_volume_stats_used_bytes {namespace=\"${namespace.value}\"})) * 0 +1)\n  and\n  (\n    (max by (persistentvolumeclaim,namespace) (kubelet_volume_stats_used_bytes {namespace=\"${namespace.value}\"})) / (max by (persistentvolumeclaim,namespace) (kubelet_volume_stats_capacity_bytes {namespace=\"${namespace.value}\"}))\n  ) >= ($pvc_percent_used_warning_threshold / 100)\n)"
                                },
                                "legendTemplate": ""
                            }
                        ]
                    }
                },
                "xPos": 8,
                "yPos": 22,
                "height": 6,
                "width": 16
            },
            {
                "widget": {
                    "scorecard": {
                        "sparkChartView": {
                            "sparkChartType": "SPARK_LINE"
                        },
                        "thresholds": [],
                        "timeSeriesQuery": {
                            "prometheusQuery": "(sum (pv_collector_bound_pvc_count {exported_namespace = \"${namespace.value}\"})) or vector(0)"
                        }
                    },
                    "title": "Bound PVCs"
                },
                "xPos": 0,
                "yPos": 28,
                "height": 4,
                "width": 2
            },
            {
                "widget": {
                    "timeSeriesTable": {
                        "columnSettings": [
                            {
                                "column": "value",
                                "visible": false
                            }
                        ],
                        "dataSets": [
                            {
                                "timeSeriesQuery": {
                                    "prometheusQuery": " (kube_persistentvolumeclaim_info { namespace = \"${namespace.value}\" })"
                                },
                                "outputFullDuration": true
                            },
                            {
                                "timeSeriesQuery": {
                                    "prometheusQuery": "(1-max by (persistentvolumeclaim, namespace) (kube_persistentvolumeclaim_info { namespace = \"${namespace.value}\" }) ) unless (max by (namespace, persistentvolumeclaim) (kubelet_volume_stats_used_bytes { namespace = \"${namespace.value}\" })) or ((max by (persistentvolumeclaim, namespace) (kube_persistentvolumeclaim_info { namespace = \"${namespace.value}\" }) ) and (max by (namespace, persistentvolumeclaim) (kubelet_volume_stats_used_bytes { namespace = \"${namespace.value}\" })))"
                                },
                                "outputFullDuration": true
                            },
                            {
                                "timeSeriesQuery": {
                                    "prometheusQuery": "max by (persistentvolumeclaim,namespace) (kubelet_volume_stats_used_bytes { namespace = \"${namespace.value}\" })"
                                },
                                "outputFullDuration": true
                            },
                            {
                                "timeSeriesQuery": {
                                    "prometheusQuery": "max by (persistentvolumeclaim,namespace) (kubelet_volume_stats_capacity_bytes { namespace = \"${namespace.value}\" })"
                                },
                                "outputFullDuration": true
                            },
                            {
                                "timeSeriesQuery": {
                                    "prometheusQuery": "max by (persistentvolumeclaim,namespace) (kubelet_volume_stats_available_bytes { namespace = \"${namespace.value}\" })"
                                },
                                "outputFullDuration": true
                            },
                            {
                                "timeSeriesQuery": {
                                    "prometheusQuery": "(max by (persistentvolumeclaim,namespace) (kubelet_volume_stats_used_bytes { namespace = \"${namespace.value}\" })) / (max by (persistentvolumeclaim,namespace) (kubelet_volume_stats_capacity_bytes { namespace = \"${namespace.value}\" }))"
                                },
                                "outputFullDuration": true
                            }
                        ],
                        "metricVisualization": "NUMBER"
                    }
                },
                "xPos": 0,
                "yPos": 32,
                "height": 9,
                "width": 24
            },
            {
                "widget": {
                    "title": "Running PVCs % Used",
                    "xyChart": {
                        "dataSets": [
                            {
                                "plotType": "LINE",
                                "timeSeriesQuery": {
                                    "prometheusQuery": "(max by (persistentvolumeclaim,namespace) (kubelet_volume_stats_used_bytes {namespace=\"${namespace.value}\"})) / (max by (persistentvolumeclaim,namespace) (kubelet_volume_stats_capacity_bytes {namespace=\"${namespace.value}\"})) * 100"
                                },
                                "legendTemplate": "{{persistentvolumeclaim}}"
                            }
                        ]
                    }
                },
                "xPos": 0,
                "yPos": 41,
                "height": 8,
                "width": 24
            },
            {
                "widget": {
                    "title": "All Running PVCs Used Bytes",
                    "xyChart": {
                        "dataSets": [
                            {
                                "plotType": "LINE",
                                "timeSeriesQuery": {
                                    "prometheusQuery": "(max by (persistentvolumeclaim,namespace) (kubelet_volume_stats_used_bytes {namespace=\"${namespace.value}\"}))"
                                },
                                "legendTemplate": "{{persistentvolumeclaim}}"
                            }
                        ]
                    }
                },
                "xPos": 0,
                "yPos": 49,
                "height": 8,
                "width": 24
            },
            {
                "widget": {
                    "title": "$persistentvolumeclaim",
                    "xyChart": {
                        "dataSets": [
                            {
                                "plotType": "LINE",
                                "timeSeriesQuery": {
                                    "prometheusQuery": "(max by (persistentvolumeclaim,namespace) (kubelet_volume_stats_used_bytes {namespace=\"${namespace.value}\", persistentvolumeclaim=\"${persistentvolumeclaim.value}\"}))"
                                },
                                "legendTemplate": "Used"
                            },
                            {
                                "plotType": "LINE",
                                "timeSeriesQuery": {
                                    "prometheusQuery": "(max by (persistentvolumeclaim,namespace) (kubelet_volume_stats_capacity_bytes {namespace=\"${namespace.value}\", persistentvolumeclaim=\"${persistentvolumeclaim.value}\"}))"
                                },
                                "legendTemplate": "Capacity"
                            }
                        ]
                    }
                },
                "xPos": 0,
                "yPos": 57,
                "height": 7,
                "width": 6
            },
            {
                "widget": {
                    "title": "$persistentvolumeclaim",
                    "xyChart": {
                        "dataSets": [
                            {
                                "plotType": "LINE",
                                "timeSeriesQuery": {
                                    "prometheusQuery": "(max by (persistentvolumeclaim,namespace) (kubelet_volume_stats_used_bytes {namespace=\"${namespace.value}\", persistentvolumeclaim=\"${persistentvolumeclaim.value}\"}))"
                                },
                                "legendTemplate": "Used"
                            },
                            {
                                "plotType": "LINE",
                                "timeSeriesQuery": {
                                    "prometheusQuery": "(max by (persistentvolumeclaim,namespace) (kubelet_volume_stats_capacity_bytes {namespace=\"${namespace.value}\", persistentvolumeclaim=\"${persistentvolumeclaim.value}\"}))"
                                },
                                "legendTemplate": "Capacity"
                            }
                        ]
                    }
                },
                "xPos": 6,
                "yPos": 57,
                "height": 7,
                "width": 6
            },
            {
                "widget": {
                    "title": "$persistentvolumeclaim",
                    "xyChart": {
                        "dataSets": [
                            {
                                "plotType": "LINE",
                                "timeSeriesQuery": {
                                    "prometheusQuery": "(max by (persistentvolumeclaim,namespace) (kubelet_volume_stats_used_bytes {namespace=\"${namespace.value}\", persistentvolumeclaim=\"${persistentvolumeclaim.value}\"}))"
                                },
                                "legendTemplate": "Used"
                            },
                            {
                                "plotType": "LINE",
                                "timeSeriesQuery": {
                                    "prometheusQuery": "(max by (persistentvolumeclaim,namespace) (kubelet_volume_stats_capacity_bytes {namespace=\"${namespace.value}\", persistentvolumeclaim=\"${persistentvolumeclaim.value}\"}))"
                                },
                                "legendTemplate": "Capacity"
                            }
                        ]
                    }
                },
                "xPos": 12,
                "yPos": 57,
                "height": 7,
                "width": 6
            },
            {
                "widget": {
                    "title": "$persistentvolumeclaim",
                    "xyChart": {
                        "dataSets": [
                            {
                                "plotType": "LINE",
                                "timeSeriesQuery": {
                                    "prometheusQuery": "(max by (persistentvolumeclaim,namespace) (kubelet_volume_stats_used_bytes {namespace=\"${namespace.value}\", persistentvolumeclaim=\"${persistentvolumeclaim.value}\"}))"
                                },
                                "legendTemplate": "Used"
                            },
                            {
                                "plotType": "LINE",
                                "timeSeriesQuery": {
                                    "prometheusQuery": "(max by (persistentvolumeclaim,namespace) (kubelet_volume_stats_capacity_bytes {namespace=\"${namespace.value}\", persistentvolumeclaim=\"${persistentvolumeclaim.value}\"}))"
                                },
                                "legendTemplate": "Capacity"
                            }
                        ]
                    }
                },
                "xPos": 18,
                "yPos": 57,
                "height": 7,
                "width": 6
            },
            {
                "widget": {
                    "title": "$persistentvolumeclaim",
                    "xyChart": {
                        "dataSets": [
                            {
                                "plotType": "LINE",
                                "timeSeriesQuery": {
                                    "prometheusQuery": "(max by (persistentvolumeclaim,namespace) (kubelet_volume_stats_used_bytes {namespace=\"${namespace.value}\", persistentvolumeclaim=\"${persistentvolumeclaim.value}\"}))"
                                },
                                "legendTemplate": "Used"
                            },
                            {
                                "plotType": "LINE",
                                "timeSeriesQuery": {
                                    "prometheusQuery": "(max by (persistentvolumeclaim,namespace) (kubelet_volume_stats_capacity_bytes {namespace=\"${namespace.value}\", persistentvolumeclaim=\"${persistentvolumeclaim.value}\"}))"
                                },
                                "legendTemplate": "Capacity"
                            }
                        ]
                    }
                },
                "xPos": 0,
                "yPos": 64,
                "height": 7,
                "width": 6
            },
            {
                "widget": {
                    "title": "$persistentvolumeclaim",
                    "xyChart": {
                        "dataSets": [
                            {
                                "plotType": "LINE",
                                "timeSeriesQuery": {
                                    "prometheusQuery": "(max by (persistentvolumeclaim,namespace) (kubelet_volume_stats_used_bytes {namespace=\"${namespace.value}\", persistentvolumeclaim=\"${persistentvolumeclaim.value}\"}))"
                                },
                                "legendTemplate": "Used"
                            },
                            {
                                "plotType": "LINE",
                                "timeSeriesQuery": {
                                    "prometheusQuery": "(max by (persistentvolumeclaim,namespace) (kubelet_volume_stats_capacity_bytes {namespace=\"${namespace.value}\", persistentvolumeclaim=\"${persistentvolumeclaim.value}\"}))"
                                },
                                "legendTemplate": "Capacity"
                            }
                        ]
                    }
                },
                "xPos": 6,
                "yPos": 64,
                "height": 7,
                "width": 6
            },
            {
                "widget": {
                    "title": "Hourly Volume Use Rate",
                    "xyChart": {
                        "dataSets": [
                            {
                                "plotType": "LINE",
                                "timeSeriesQuery": {
                                    "prometheusQuery": "rate(kubelet_volume_stats_used_bytes {namespace=\"${namespace.value}\"}[1h])"
                                },
                                "legendTemplate": "{{namespace}} ({{persistentvolumeclaim}})"
                            }
                        ]
                    }
                },
                "xPos": 0,
                "yPos": 71,
                "height": 6,
                "width": 24
            },
            {
                "widget": {
                    "title": "Daily Volume Use Rate",
                    "xyChart": {
                        "dataSets": [
                            {
                                "plotType": "LINE",
                                "timeSeriesQuery": {
                                    "prometheusQuery": "rate(kubelet_volume_stats_used_bytes {namespace=\"${namespace.value}\"}[1d])"
                                },
                                "legendTemplate": "{{namespace}} ({{persistentvolumeclaim}})"
                            }
                        ]
                    }
                },
                "xPos": 0,
                "yPos": 77,
                "height": 6,
                "width": 24
            },
            {
                "widget": {
                    "title": "Weekly Volume Use Rate",
                    "xyChart": {
                        "dataSets": [
                            {
                                "plotType": "LINE",
                                "timeSeriesQuery": {
                                    "prometheusQuery": "rate(kubelet_volume_stats_used_bytes {namespace=\"${namespace.value}\"}[1w])"
                                },
                                "legendTemplate": "{{namespace}} ({{persistentvolumeclaim}})"
                            }
                        ]
                    }
                },
                "xPos": 0,
                "yPos": 83,
                "height": 6,
                "width": 24
            }
        ]
    }
}